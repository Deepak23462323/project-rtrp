<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'bounce-slow': 'bounce 1.5s infinite',
                    },
                }
            }
        }
    </script>
    <style>
        @keyframes dotFade {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }
        .animate-dot-1 { animation: dotFade 1.5s infinite 0s; }
        .animate-dot-2 { animation: dotFade 1.5s infinite 0.3s; }
        .animate-dot-3 { animation: dotFade 1.5s infinite 0.6s; }
        .history-panel::-webkit-scrollbar {
            width: 6px;
        }
        .history-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .history-panel::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .history-panel::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">AI Chat Interface</h1>
        
        <div class="flex gap-6">
            <!-- Main Chat Area -->
            <div class="flex-1 max-w-3xl">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="mb-4">
                        <label for="examplePrompts" class="block text-sm font-medium text-gray-700 mb-2">Example Prompts</label>
                        <select id="examplePrompts" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white">
                            <option value="">Select an example prompt...</option>
                            <option value="Please summarize the following text: ">Summarize Text</option>
                            <option value="Please explain how this code works: ">Explain Code</option>
                            <option value="Write a blog post introduction about: ">Write Blog Intro</option>
                            <option value="Generate a creative story about: ">Creative Story</option>
                            <option value="Translate the following text to Spanish: ">Translate to Spanish</option>
                            <option value="Debug the following code and explain the issues: ">Debug Code</option>
                            <option value="Create a step-by-step tutorial for: ">Create Tutorial</option>
                            <option value="Compare and contrast the following: ">Compare and Contrast</option>
                        </select>
                    </div>
                    <textarea 
                        id="userPrompt" 
                        class="w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                        placeholder="Type your message here..."></textarea>
                    
                    <div class="mt-4 flex justify-end">
                        <button 
                            id="sendButton"
                            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg transition duration-200">
                            Send
                        </button>
                    </div>
                </div>

                <!-- Loading animation -->
                <div id="loadingIndicator" class="hidden bg-white rounded-lg shadow-md p-6 text-center mt-4">
                    <div class="flex items-center justify-center space-x-2">
                        <span class="text-3xl text-blue-500 animate-dot-1">•</span>
                        <span class="text-3xl text-blue-500 animate-dot-2">•</span>
                        <span class="text-3xl text-blue-500 animate-dot-3">•</span>
                    </div>
                    <p class="text-gray-500 mt-2">AI is thinking...</p>
                </div>

                <div id="aiResponse" class="bg-white rounded-lg shadow-md p-6 min-h-[200px] mt-4">
                    <p class="text-gray-500">AI response will appear here...</p>
                </div>
            </div>

            <!-- History Panel -->
            <div class="w-96">
                <div class="bg-white rounded-lg shadow-md p-4">
                    <h2 class="text-lg font-semibold text-gray-700 mb-4">Conversation History</h2>
                    <div id="historyPanel" class="history-panel space-y-4 overflow-y-auto max-h-[600px] pr-2">
                        <!-- History items will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize conversation history array
        let conversationHistory = [];

        // Add event listener for example prompts
        document.getElementById('examplePrompts').addEventListener('change', (e) => {
            const textarea = document.getElementById('userPrompt');
            const selectedPrompt = e.target.value;
            
            if (selectedPrompt) {
                textarea.value = selectedPrompt;
                textarea.focus();
                // Place cursor at the end of the prompt
                textarea.setSelectionRange(selectedPrompt.length, selectedPrompt.length);
                
                // Reset dropdown
                setTimeout(() => {
                    e.target.value = '';
                }, 100);
            }
        });

        function addToHistory(prompt, response, isError = false) {
            const historyItem = {
                prompt,
                response,
                timestamp: new Date(),
                isError
            };
            conversationHistory.unshift(historyItem); // Add to beginning of array
            updateHistoryPanel();
        }

        function updateHistoryPanel() {
            const historyPanel = document.getElementById('historyPanel');
            historyPanel.innerHTML = conversationHistory.map((item, index) => `
                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:border-blue-200 transition-colors">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-sm font-medium text-gray-600">Prompt:</p>
                        <span class="text-xs text-gray-400">${item.timestamp.toLocaleTimeString()}</span>
                    </div>
                    <p class="text-gray-800 mb-3 text-sm">${item.prompt}</p>
                    <p class="text-sm font-medium text-gray-600 mb-1">Response:</p>
                    <div class="${item.isError ? 'text-red-600' : 'text-gray-800'} text-sm whitespace-pre-wrap">
                        ${item.response}
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('sendButton').addEventListener('click', async () => {
            const userPrompt = document.getElementById('userPrompt').value;
            const aiResponse = document.getElementById('aiResponse');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const sendButton = document.getElementById('sendButton');
            
            if (userPrompt.trim() !== '') {
                try {
                    // Disable button and show loading state
                    sendButton.disabled = true;
                    sendButton.classList.add('opacity-50', 'cursor-not-allowed');
                    aiResponse.classList.add('hidden');
                    loadingIndicator.classList.remove('hidden');

                    // Send POST request to API
                    const response = await fetch('/api/gemini', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ prompt: userPrompt })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // Hide loading and show response
                    loadingIndicator.classList.add('hidden');
                    aiResponse.classList.remove('hidden');
                    aiResponse.innerHTML = `
                        <div class="prose">
                            <p class="text-gray-800 whitespace-pre-wrap">${data.response}</p>
                        </div>
                    `;

                    // Add to history
                    addToHistory(userPrompt, data.response);
                    document.getElementById('userPrompt').value = '';

                } catch (error) {
                    // Handle errors
                    loadingIndicator.classList.add('hidden');
                    aiResponse.classList.remove('hidden');
                    const errorMessage = `
                        <div class="bg-red-50 border-l-4 border-red-500 p-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-red-700">Error: ${error.message}</p>
                                    <p class="text-red-500 text-sm">Please try again later.</p>
                                </div>
                            </div>
                        </div>
                    `;
                    aiResponse.innerHTML = errorMessage;
                    // Add error to history
                    addToHistory(userPrompt, error.message, true);
                } finally {
                    // Re-enable button
                    sendButton.disabled = false;
                    sendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
        });
    </script>
</body>
</html> 